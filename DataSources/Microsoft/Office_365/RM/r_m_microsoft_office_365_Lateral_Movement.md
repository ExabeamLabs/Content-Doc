Vendor: Microsoft
=================
### Product: [Office 365](../ds_microsoft_office_365.md)
### Use-Case: [Lateral Movement](../../../../UseCases/uc_lateral_movement.md)

| Rules | Models | MITRE TTPs | Event Types | Parsers |
|:-----:|:------:|:----------:|:-----------:|:-------:|
|  102  |   18   |     22     |     21      |   21    |

| Event Type          | Rules    | Models    |
| ---- | ---- | ---- |
| app-activity        | <b>T1090.003 - Proxy: Multi-hop Proxy</b><br> ↳ <b>Auth-Tor-Shost</b>: User authentication or login from a known TOR IP    |    |
| app-activity-failed | <b>T1078 - Valid Accounts</b><br> ↳ <b>Auth-Tor-Shost-Failed</b>: User authentication or login failure from a known TOR IP<br><br><b>T1090.003 - Proxy: Multi-hop Proxy</b><br> ↳ <b>Auth-Tor-Shost-Failed</b>: User authentication or login failure from a known TOR IP    |    |
| app-login    | <b>T1090.003 - Proxy: Multi-hop Proxy</b><br> ↳ <b>Auth-Tor-Shost</b>: User authentication or login from a known TOR IP    |    |
| failed-app-login    | <b>T1078 - Valid Accounts</b><br> ↳ <b>Auth-Tor-Shost-Failed</b>: User authentication or login failure from a known TOR IP<br><br><b>T1090.003 - Proxy: Multi-hop Proxy</b><br> ↳ <b>Auth-Tor-Shost-Failed</b>: User authentication or login failure from a known TOR IP    |    |
| failed-logon        | <b>T1550.002 - Use Alternate Authentication Material: Pass the Hash</b><br> ↳ <b>A-PTH-ALERT-sH-Failed</b>: Failed pass the hash attack with keylength of 0 in NTLM event and a 'null' sid on this source host.<br> ↳ <b>FAIL-PTH-ALERT-sH</b>: Possible unsuccessful pass the hash attack from the source<br> ↳ <b>FAIL-PTH-ALERT-dH</b>: Possible unsuccessful pass the hash attack by the user<br> ↳ <b>PTH-ALERT-sH-Failed</b>: Failed pass the hash attack with keylength of 0 in NTLM event and a 'null' sid.<br><br><b>T1021.001 - Remote Services: Remote Desktop Protocol</b><br> ↳ <b>RDP-Brute-Force</b>: Abnormal number of RDP failed logons for this user<br><br><b>T1110 - Brute Force</b><br> ↳ <b>A-FL-MULTI-USERS-S</b>: Multiple users failed to login (S)<br> ↳ <b>A-FL-MULTI-USERS-L</b>: Multiple users failed to login (L)<br> ↳ <b>A-FL-MULTI-USERS-M</b>: Multiple users failed to login (M)<br> ↳ <b>A-FL-MULTI-DEST-S</b>: Failed logins to multiple destinations from host (S)<br> ↳ <b>A-FL-MULTI-DEST-M</b>: Failed logins to multiple destinations from host (M)<br> ↳ <b>RDP-Brute-Force</b>: Abnormal number of RDP failed logons for this user<br><br><b>T1078 - Valid Accounts</b><br> ↳ <b>Auth-Tor-Shost-Failed</b>: User authentication or login failure from a known TOR IP<br><br><b>T1090.003 - Proxy: Multi-hop Proxy</b><br> ↳ <b>Auth-Tor-Shost-Failed</b>: User authentication or login failure from a known TOR IP<br><br><b>T1550.003 - Use Alternate Authentication Material: Pass the Ticket</b><br> ↳ <b>KL-TfG</b>: Rare Kerberos ticket failure code<br> ↳ <b>KL-Tf-fail</b>: Failed logon due to a malformed authentication ticket<br><br><b>T1558 - Steal or Forge Kerberos Tickets</b><br> ↳ <b>KL-TfG</b>: Rare Kerberos ticket failure code<br> ↳ <b>KL-Tf-fail</b>: Failed logon due to a malformed authentication ticket<br><br><b>T1110.003 - T1110.003</b><br> ↳ <b>A-FL-MULTI-USERS-SRC</b>: The same host failed to login to multiple users    |  • <b>AE-OHr</b>: Random hostnames    |
| ntlm-logon          | <b>T1078 - Valid Accounts</b><br> ↳ <b>NKL-UH-A</b>: Abnormal NTLM/Kerberos logon to asset<br> ↳ <b>NKL-GH-F-new</b>: First kerberos/ntlm logon to server for peer group by new user<br> ↳ <b>NKL-GH-A-new</b>: Abnormal kerberos/ntlm logon on asset for peer group by new user<br> ↳ <b>NKL-HU-F-new</b>: Ntlm/Kerberos logon to private asset for new user<br><br><b>T1550.002 - Use Alternate Authentication Material: Pass the Hash</b><br> ↳ <b>A-PTH-ALERT-dH</b>: Possible pass the hash attack by this user account<br> ↳ <b>PTH-ALERT-dH</b>: Possible pass the hash attack by the user<br> ↳ <b>AE-NTLM-WsSrv</b>: New generic hostname found using ntlm authentication<br> ↳ <b>NKL-UH-A</b>: Abnormal NTLM/Kerberos logon to asset<br> ↳ <b>NKL-GH-F-new</b>: First kerberos/ntlm logon to server for peer group by new user<br> ↳ <b>NKL-GH-A-new</b>: Abnormal kerberos/ntlm logon on asset for peer group by new user<br> ↳ <b>NKL-HU-F-new</b>: Ntlm/Kerberos logon to private asset for new user<br><br><b>T1550.003 - Use Alternate Authentication Material: Pass the Ticket</b><br> ↳ <b>EXPERT-PENTEST-DOMAINS</b>: Possible credentials theft attack detected<br> ↳ <b>NKL-UH-A</b>: Abnormal NTLM/Kerberos logon to asset<br> ↳ <b>NKL-GH-F-new</b>: First kerberos/ntlm logon to server for peer group by new user<br> ↳ <b>NKL-GH-A-new</b>: Abnormal kerberos/ntlm logon on asset for peer group by new user<br> ↳ <b>NKL-HU-F-new</b>: Ntlm/Kerberos logon to private asset for new user<br><br><b>T1558 - Steal or Forge Kerberos Tickets</b><br> ↳ <b>EXPERT-PENTEST-DOMAINS</b>: Possible credentials theft attack detected<br> ↳ <b>NKL-UH-A</b>: Abnormal NTLM/Kerberos logon to asset<br> ↳ <b>NKL-GH-F-new</b>: First kerberos/ntlm logon to server for peer group by new user<br> ↳ <b>NKL-GH-A-new</b>: Abnormal kerberos/ntlm logon on asset for peer group by new user<br> ↳ <b>NKL-HU-F-new</b>: Ntlm/Kerberos logon to private asset for new user    |  • <b>NKL-HU</b>: Users logging into this host remotely<br> • <b>KL-GH</b>: Assets accessed by this peer group while logging in remotely<br> • <b>AE-NTLM</b>: Models ntlm hostnames in the organization<br> • <b>AE-OHr</b>: Random hostnames<br> • <b>A-AE-OHr</b>: Random hostnames on asset    |
| process-created     | <b>T1021.003 - T1021.003</b><br> ↳ <b>A-Impacket-Lateral-Detection</b>: Activity related to Impacket framework using wmiexec, dcomexe, or smbexec processes via command line have been found on this asset.<br> ↳ <b>A-PC-ParentName-ProcessName-DCOM-F</b>: First time child process creation for DCOM associated process on this asset.<br> ↳ <b>A-PC-ParentName-ProcessName-DCOM-A</b>: Abnormal child process creation for DCOM associated process on the asset.<br> ↳ <b>A-DCOMActivation-Known</b>: Remote DCOM activation under DcomLaunch service on this asset.<br> ↳ <b>Impacket-Lateral-Detection</b>: Activity related to Impacket framework using wmiexec, dcomexe, or smbexec processes via command line have been found.<br> ↳ <b>PC-ParentName-ProcessName-DCOM-F</b>: First time child process creation for DCOM associated process<br> ↳ <b>PC-ParentName-ProcessName-DCOM-A</b>: Abnormal child process creation for DCOM associated process.<br> ↳ <b>DCOMActivation-Known</b>: Remote DCOM activation under DcomLaunch service<br><br><b>T1210 - Exploitation of Remote Services</b><br> ↳ <b>A-Terminal-Svc-Proc-Spawn</b>: Process spawned by the terminal service server on this asset.<br> ↳ <b>Terminal-Svc-Proc-Spawn</b>: Process spawned by the terminal service server<br><br><b>T1090 - Proxy</b><br> ↳ <b>A-Netsh-Port-Fwd</b>: Netsh commands were used to configure port forwarding on this asset.<br> ↳ <b>Netsh-Port-Fwd</b>: Netsh commands were used to configure port forwarding.<br><br><b>T1021.001 - Remote Services: Remote Desktop Protocol</b><br> ↳ <b>A-Suspicious-RDP-TSCON</b>: Suspicious usage of RDP using tscon.exe on this asset<br> ↳ <b>A-Netsh-RDP-Port-Fwd</b>: Netsh commands used to configure port forwarding for port 3389, used for RDP, were detected on this asset.<br> ↳ <b>Suspicious-RDP-TSCON</b>: Suspicious usage of RDP using tscon.exe<br> ↳ <b>Netsh-RDP-Port-Fwd</b>: Netsh commands used to configure port forwarding for port 3389, used for RDP, were detected.<br><br><b>T1047 - Windows Management Instrumentation</b><br> ↳ <b>A-Impacket-Lateral-Detection</b>: Activity related to Impacket framework using wmiexec, dcomexe, or smbexec processes via command line have been found on this asset.<br> ↳ <b>Impacket-Lateral-Detection</b>: Activity related to Impacket framework using wmiexec, dcomexe, or smbexec processes via command line have been found.<br><br><b>T1021.006 - T1021.006</b><br> ↳ <b>A-Remote-Powershell-Session</b>: Remote Powershell session was detected by monitoring for wsmprovhost as a parent or child process on this asset.<br> ↳ <b>Remote-Powershell-Session</b>: Remote Powershell session was detected by monitoring for wsmprovhost as a parent or child process.<br><br><b>T1059.001 - Command and Scripting Interperter: PowerShell</b><br> ↳ <b>A-Remote-Powershell-Session</b>: Remote Powershell session was detected by monitoring for wsmprovhost as a parent or child process on this asset.<br> ↳ <b>Remote-Powershell-Session</b>: Remote Powershell session was detected by monitoring for wsmprovhost as a parent or child process.<br><br><b>T1219 - Remote Access Software</b><br> ↳ <b>A-EPA-RAT-TSS</b>: TeamViewer remote desktop access service started on this asset<br> ↳ <b>A-EPA-RAT-SSI</b>: Splashtop remote desktop access service installed on this asset<br> ↳ <b>A-EPA-RAT-TI</b>: TeamViewer remote desktop access agent installed on this asset<br> ↳ <b>A-EPA-RAT-SSS</b>: Splashtop remote desktop access service started on this asset<br> ↳ <b>A-EPA-RAT-SI</b>: Splashtop remote desktop access agent installed on this asset<br> ↳ <b>A-EPA-RAT-GSS</b>: GoToMyPC remote desktop access service started on this asset<br> ↳ <b>A-EPA-RAT-GSI</b>: GoToMyPC remote desktop access service installed on this asset<br> ↳ <b>A-EPA-RAT-TSI</b>: TeamViewer remote desktop access service installed on this asset<br> ↳ <b>A-EPA-RAT-LSS</b>: LogMeIn remote desktop access service started on this asset<br> ↳ <b>A-EPA-RAT-LSI</b>: LogMeIn remote desktop access service installed on this asset<br> ↳ <b>A-EPA-RAT-LI</b>: LogMeIn remote desktop access agent installed on this asset<br> ↳ <b>A-EPA-RAT-GI</b>: GoToMyPC remote desktop access agent installed on this asset<br> ↳ <b>A-TSCON-LocalSystem</b>: Tscon.exe was executed as Local System on this asset<br> ↳ <b>EPA-RAT-GSI</b>: GoToMyPC remote desktop access service installed by this user<br> ↳ <b>EPA-RAT-LSS</b>: LogMeIn remote desktop access service started by this user<br> ↳ <b>EPA-RAT-LI</b>: LogMeIn remote desktop access agent installed by this user<br> ↳ <b>EPA-RAT-SSI</b>: Splashtop remote desktop access service installed by this user<br> ↳ <b>EPA-RAT-SI</b>: Splashtop remote desktop access agent installed by this user<br> ↳ <b>EPA-RAT-TSI</b>: TeamViewer remote desktop access service installed by this user<br> ↳ <b>EPA-RAT-GI</b>: GoToMyPC remote desktop access agent installed by this user<br> ↳ <b>EPA-RAT-TI</b>: TeamViewer remote desktop access agent installed by this user<br> ↳ <b>EPA-RAT-GSS</b>: GoToMyPC remote desktop access service started by this user<br> ↳ <b>EPA-RAT-TSS</b>: TeamViewer remote desktop access service started by this user<br> ↳ <b>EPA-RAT-SSS</b>: Splashtop remote desktop access service started by this user<br> ↳ <b>EPA-RAT-LSI</b>: LogMeIn remote desktop access service installed by this user<br><br><b>T1563.002 - T1563.002</b><br> ↳ <b>A-TSCON-LocalSystem</b>: Tscon.exe was executed as Local System on this asset |  • <b>PC-ParentName-ProcessName</b>: Child processes created by a parent process<br> • <b>A-PC-ParentName-ProcessName</b>: Processes for parent parent processes.    |
| remote-logon        | <b>T1021 - Remote Services</b><br> ↳ <b>A-RLA-sHdZ-F</b>: First remote access to zone from asset<br> ↳ <b>A-RLA-sHdZ-A</b>: Abnormal remote access to zone from asset<br> ↳ <b>A-RLA-dHsZ-F</b>: First remote access from zone to asset<br> ↳ <b>A-RLA-dHsZ-A</b>: Abnormal remote access from zone to asset<br> ↳ <b>RL-UH-sZ-F</b>: First remote logon to asset from new or abnormal source network zone<br> ↳ <b>RL-UH-sZ-A</b>: Abnormal remote logon to asset from new or abnormal source network zone<br> ↳ <b>RLA-UsZ-F</b>: First source network zone for user<br> ↳ <b>RLA-UsZ-A</b>: Abnormal source network zone for user<br> ↳ <b>RLA-UsH-dZ-F</b>: First remote access to zone from new asset<br> ↳ <b>RLA-UsH-dZ-A</b>: Abnormal remote access to zone from new asset<br> ↳ <b>RLA-dZsZ-F</b>: First inter-zone communication from destination to source<br> ↳ <b>RLA-sZdZ-F</b>: First inter-zone communication from source to destination<br> ↳ <b>RLA-sZdZ-A</b>: Abnormal inter-zone communication<br> ↳ <b>RL-UH-F</b>: First remote logon to asset<br> ↳ <b>RL-UH-A</b>: Abnormal remote logon to asset<br> ↳ <b>RL-GH-F</b>: First remote logon to asset for group<br> ↳ <b>RL-GH-A-new</b>: Abnormal remote logon to asset for group by new user<br> ↳ <b>RL-HU-F-new</b>: Remote logon to private asset for new user<br><br><b>T1078 - Valid Accounts</b><br> ↳ <b>RL-UH-sZ-F</b>: First remote logon to asset from new or abnormal source network zone<br> ↳ <b>RL-UH-sZ-A</b>: Abnormal remote logon to asset from new or abnormal source network zone<br> ↳ <b>RLA-UsZ-F</b>: First source network zone for user<br> ↳ <b>RLA-UsZ-A</b>: Abnormal source network zone for user<br> ↳ <b>RLA-UsH-dZ-F</b>: First remote access to zone from new asset<br> ↳ <b>RLA-UsH-dZ-A</b>: Abnormal remote access to zone from new asset<br> ↳ <b>RLA-dZsZ-F</b>: First inter-zone communication from destination to source<br> ↳ <b>RLA-sZdZ-F</b>: First inter-zone communication from source to destination<br> ↳ <b>RLA-sZdZ-A</b>: Abnormal inter-zone communication<br> ↳ <b>RL-UH-F</b>: First remote logon to asset<br> ↳ <b>RL-UH-A</b>: Abnormal remote logon to asset<br> ↳ <b>RL-GH-F</b>: First remote logon to asset for group<br> ↳ <b>RL-GH-A-new</b>: Abnormal remote logon to asset for group by new user<br> ↳ <b>RL-HU-F-new</b>: Remote logon to private asset for new user<br><br><b>T1550.002 - Use Alternate Authentication Material: Pass the Hash</b><br> ↳ <b>A-AE-SwSh-F</b>: New server hostname using NTLM authentication in the organization.<br> ↳ <b>A-NTLM-WsSrv</b>: Hostname contains workstation or server<br> ↳ <b>A-NTLM-mismatch</b>: Mismatch between logged and resolved hostnames<br> ↳ <b>A-PTH-ALERT-sH-Possible</b>: Possible pass the hash attack with keylength of 0 in NTLM event and a 'null' sid on this source host.<br> ↳ <b>AE-NTLM-WsSrv</b>: New generic hostname found using ntlm authentication<br> ↳ <b>NTLM-mismatch</b>: <br> ↳ <b>PTH-ALERT-sH-Possible</b>: Possible pass the hash attack with keylength of 0 in NTLM event and a 'null' sid.<br><br><b>T1550 - Use Alternate Authentication Material</b><br> ↳ <b>RLA-UAPackage-F</b>: First time usage of Windows authentication package<br> ↳ <b>RLA-UAPackage-A</b>: Abnormal usage of Windows authentication package<br><br><b>T1090.003 - Proxy: Multi-hop Proxy</b><br> ↳ <b>Auth-Tor-Shost</b>: User authentication or login from a known TOR IP<br><br><b>T1558.003 - Steal or Forge Kerberos Tickets: Kerberoasting</b><br> ↳ <b>A-KL-ToEt-Roast</b>: Suspicious or weak encryption type used for obtaining the kerberos TGTs using non kerberos service for this asset<br> ↳ <b>KL-ToEt-Roast</b>: Suspicious or weak encryption type used for obtaining kerberos TGTs using non kerberos service<br><br><b>T1550.003 - Use Alternate Authentication Material: Pass the Ticket</b><br> ↳ <b>EXPERT-PENTEST-DOMAINS</b>: Possible credentials theft attack detected<br><br><b>T1558 - Steal or Forge Kerberos Tickets</b><br> ↳ <b>EXPERT-PENTEST-DOMAINS</b>: Possible credentials theft attack detected<br><br><b>T1018 - Remote System Discovery</b><br> ↳ <b>A-RLA-sHdZ-F</b>: First remote access to zone from asset<br> ↳ <b>A-RLA-sHdZ-A</b>: Abnormal remote access to zone from asset<br> ↳ <b>A-RLA-dHsZ-F</b>: First remote access from zone to asset<br> ↳ <b>A-RLA-dHsZ-A</b>: Abnormal remote access from zone to asset    |  • <b>RL-HU</b>: Remote logon users<br> • <b>RL-GH-A</b>: Assets accessed remotely by this peer group<br> • <b>RLA-UAPackage</b>: Windows authentication packages used when connecting to remote hosts<br> • <b>RL-UH</b>: Remote logons<br> • <b>AE-NTLM</b>: Models ntlm hostnames in the organization<br> • <b>AE-OHr</b>: Random hostnames<br> • <b>RLA-sZdZ</b>: Destination zone communication<br> • <b>RLA-dZsZ</b>: Source zone communication<br> • <b>AL-UsH</b>: Source hosts per User<br> • <b>RLA-UsZ</b>: Source zones for user<br> • <b>A-AE-OHr</b>: Random hostnames on asset<br> • <b>A-AE-NTLM</b>: Models the NTLM hostnames seen in the organization<br> • <b>A-RLA-dHsZ</b>: Destination Host to Source zone communication<br> • <b>A-RLA-sHdZ</b>: Source Host to Destination zone communication |
| security-alert      | <b>T1027.005 - Obfuscated Files or Information: Indicator Removal from Tools</b><br> ↳ <b>A-ALERT-DL</b>: DL Correlation rule alert on asset<br> ↳ <b>ALERT-DL</b>: DL Correlation rule alert on asset accessed by this user    |    |
| web-activity-denied | <b>T1071.001 - Application Layer Protocol: Web Protocols</b><br> ↳ <b>WEB-URank-Tor</b>: User has accessed a tor-to-web proxy site<br><br><b>T1090.003 - Proxy: Multi-hop Proxy</b><br> ↳ <b>A-NETF-TOR-Outbound</b>: Outbound failed connection to a known TOR IP<br> ↳ <b>A-WEB-TorProxy</b>: Asset has accessed a known Tor web proxy<br> ↳ <b>A-WEB-UU-Tor</b>: Asset has accessed a URL containing '/tor/server'<br> ↳ <b>WEB-UD-TorProxy</b>: User has accessed a known Tor web proxy<br> ↳ <b>WEB-UI-Tor</b>: User has accessed a known Tor exit node<br> ↳ <b>WEB-UU-Tor</b>: User has accessed a URL containing '/tor/server'<br> ↳ <b>WEB-URank-Tor</b>: User has accessed a tor-to-web proxy site    |    |